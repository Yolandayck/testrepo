name: CI/CD Pipeline

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 18
        
    - name: Install dependencies
      run: npm install
      
    - name: Run ESLint Security
      run: |
        npm install eslint-plugin-security --save-dev
        npx eslint --plugin security --rule 'security/detect-object-injection: error' .
        
    - name: Run OWASP Dependency Check
      uses: dependency-check/Dependency-Check_Action@main
      with:
        project: "WebApp"
        path: "."
        format: "HTML"
        out: "dependency-check-report"
        
    - name: Upload Dependency Check Report
      uses: actions/upload-artifact@v4
      with:
        name: dependency-check-report
        path: dependency-check-report
        
    - name: Run UI Tests
      run: |
        npm install puppeteer --save-dev
        node ui-tests.js
        
    - name: Upload Test Results
      uses: actions/upload-artifact@v4
      with:
        name: test-results
        path: |
          *.png
          test-report.xml